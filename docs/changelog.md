# 更新日志 (Changelog)

## 2026-02-09
### 新增功能
- **异步生成模式**：点击"AI 生成"后，项目立即出现在左侧列表并显示🔵"生成中..."状态，后台线程完成生成后自动更新状态并打开预览。
- **剪切板粘贴图片**：参考图上传区域支持直接粘贴剪切板中的图片（Ctrl+V），鼠标悬停即可粘贴，无需点击。
- **前端状态轮询**：新增 `pollGenerationStatus` 函数，每3秒轮询后端状态，实时更新项目列表。

### 后端改进
- **新增 API**：`POST /generate-async` - 异步生成项目，立即返回带 `generating` 状态的项目信息，后台线程完成 AI 调用。
- **线程管理**：`handle_generate_async` 函数使用 `threading.Thread` 实现后台生成，避免阻塞前端请求。

### 前端优化
- **上传区焦点样式**：dropzone 添加 `tabindex="0"` 和焦点样式，支持键盘粘贴。
- **提示文字更新**：上传区提示更新为"点击、拖拽或粘贴上传"。

### 文件修改
- `server.py`: 新增 `handle_generate_async` 和 `_call_ai_for_async` 方法
- `src/script.js`: 修改 `generateWithAI`、新增 `pollGenerationStatus`、增强 `setupPageListeners`

## 2026-02-06
### 新增功能
- 优化微调模式提示词（新增目标文件路径、页面信息、元素详情）；新增整页面修改功能；复制提示改为Toast通知

## 2026-02-05
### 修复
- **复制 Prompt 项目ID不一致**：修复了前端 `generateProjectIdFromName()` 与后端 `generate_project_id()` 时间戳格式不一致的问题。现在前端也使用12小时制（含am/pm和秒数），确保外部AI工具能正确定位到占位项目文件夹。
- **Prompt内容优化**：复制的Prompt中现在包含完整的项目文件夹ID，而不仅是项目名称，方便外部AI工具精确定位。
- **整页面弹窗输入框**：修复输入框样式（宽度、高度、边框）并支持弹窗拖动。

### 新增功能
- **占位项目状态自动更新**：当外部AI工具生成 `index.html` 后，刷新页面会自动检测并将「待外部生成」状态更新为正常项目。
- **微调提示词优化**：元素微调提示词新增目标文件路径、当前页面/路由、元素ID/class/文本内容等信息，帮助AI IDE工具精确定位。
- **整页面修改功能**：微调模式底部提示条新增紫色「整页面」按钮，支持针对整个页面的修改需求。

## 2026-01-30
### 修复
- 修复hasAnyInput函数中getElementById的ID参数错误（多余的#符号导致null错误）
### 新增功能
- 添加输入验证：AI生成和复制Prompt按钮在无输入时显示提示
- 测试自动文档更新功能 - SKILL优化测试
- 测试自动文档更新功能 - 新增复制Prompt按钮
- **复制 Prompt 功能**：新增「复制 Prompt」按钮，支持将设计需求复制到剪贴板，可用于 Antigravity、Cursor、Claude 等外部 AI 工具。
- **占位项目**：点击复制 Prompt 后自动创建占位项目，参考图片保存到项目文件夹，标记为「待外部生成」状态。
- **状态可视化**：项目列表支持显示项目状态（生成中🔵、失败🔴、待外部生成🟡），带动画效果。

### 后端改进
- **新增 API**：`GET /api/generation-status` - 查询项目生成状态。
- **新增 API**：`POST /create-placeholder` - 创建不调用 AI 的占位项目。
- **异步基础设施**：添加线程管理和任务队列系统（`generating_tasks`），为未来异步生成做准备。

### 前端优化
- **UI 增强**：复制 Prompt 按钮采用绿色渐变配色，与 AI 生成按钮并列显示。
- **CSS 兼容性**：修复 `line-clamp` 属性的浏览器兼容性警告。

### 文件修改
- `server.py`: 添加异步任务管理、generation-status 和 create-placeholder 端点
- `src/script.js`: 实现 copyPromptToClipboard 函数和状态显示逻辑
- `src/index.html`: 新增复制 Prompt 按钮，修复 CSS 兼容性

### 备份
- 备份路径: `backups/20260130_145123_异步生成和复制Prompt功能/`
- 备份文件: `server.py`, `src/script.js`, `src/index.html`

## 2026-01-29
### 修复与优化
- **网络层增强**：彻底解决了 AI 接口调用时的 `SSLEOFError` 连接中断问题。
- **Curl 智能兜底**：实现了双层请求机制。当 Python `requests` 库因网络环境（如 VPN/代理干扰）遭遇 SSL 握手失败时，系统会自动降级调用系统原生 `curl` 命令进行重试，大幅提升了在复杂网络环境下的稳定性。
- **环境诊断**：优化了网络连接检测逻辑。

## 2026-01-26
### 维护 (Maintenance)
- **项目清理**：执行了深度清理，删除了 26 个开发过程中用于修补和更新生成项目的临时 Python 脚本及辅助工具，保持生成器项目目录整洁。

## 2026-01-24
### 新增功能
- **复制项目**：左侧项目列表新增复制按钮，支持一键复制项目到新名称。

### 修复
- **项目同步**：修复手动复制项目文件夹后未同步到列表的问题。
- **去重逻辑**：修复复制项目时可能产生重复条目的 Bug。

## 2026-01-23
### 修复
- **微调模式**：修复了弹窗因 CSS 权重问题无法关闭（一直显示）的 Bug。
- **微调模式**：优化弹窗 UI 为跟随式（非全屏遮罩），允许操作底层元素。
- **微调模式**：修复了点选和 Ctrl+多选在某些情况下失效的问题（重构为 Overlay 统一接管事件）。
- **微调模式**：弹窗尺寸优化（更紧凑），并支持按住标题栏拖拽移动。
- **全局设置**：右上角设置按钮尺寸缩小（32px），并支持自由拖拽移动（防遮挡）。

### 新增功能
- **微调模式 (Inspector Mode)**：
  - 支持点选/框选元素
  - 自动生成上下文 Prompt
  - 后端 AI 接口直接修改 HTML

## 2026-01-22
### 修复与优化
- **页面同步修复**：修复预览模式下 JS 错误，优化 iframe 同步机制。
- **UI 统一**：所有模式统一使用悬浮工具栏。
- **界面优化**：移除顶部 Header，增加返回按钮。

## 2026-01-21
### 新增功能
- **纯预览导出**：只导出原型本身，不含研发数据。
- **预览模式**：新增默认的沉浸式预览模式。

## 2026-01-19
### 新增功能
- **PRD 撰写系统**：Markdown 编辑与存储。
- **研发模式**：集成流程图与页面导航。
- **零依赖导出**：支持 `file://` 协议运行。
